@page "/product/{ProductId:int}"
@rendermode InteractiveServer
@layout MainLayout
@inject ShopContext Db
@inject NavigationManager Navigation
@inject CartService CartService


@using ECommerceShop.Configurations
@using ECommerceShop.Entities
@using Microsoft.EntityFrameworkCore
@using View.Components.Layout

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">BulkBase</a>

        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/productoverview">Home</a>
                </li>
            </ul>

            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link position-relative" href="/cart">
                        <img src="images/warenkorb.jpg" alt="Cart" style="height: 28px;" />
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
@*push*@
<!-- CONTENT -->
@code {
    private void AddToCart()
    {
        if (product != null)
        {
            CartService.AddToCart(product, quantity);
        }
    }

    
[Parameter]
public int ProductId { get; set; }

private Product? product;
private int quantity = 1;

protected override async Task OnInitializedAsync()
{
product = await Db.Products.FirstOrDefaultAsync(p => p.ProductId == ProductId);
}

private void IncreaseQuantity()
{
quantity++;
}

private void DecreaseQuantity()
{
if (quantity > 1)
quantity--;
}
}

@if (product == null)
{
<div class="container text-center mt-5">
    <h2>Product not found</h2>
</div>
}
else
{
<div class="container mt-5">
    <div class="row">
        <!-- Bildervorschau -->
        <div class="col-md-2 d-none d-md-block">
            <img src="@product.Image" class="img-thumbnail mb-3" />
            <img src="@product.Image" class="img-thumbnail mb-3" />
            <img src="@product.Image" class="img-thumbnail mb-3" />
        </div>

        <!-- Hauptbild -->
        <div class="col-md-5 text-center mb-4 mb-md-0">
            <img src="@product.Image" class="img-fluid" style="max-height: 350px;" />
        </div>

        <!-- Produktdetails -->
        <div class="col-md-5">
            <h2>@product.Name</h2>
            <div class="text-warning mb-2">
                ★★★★☆ <span class="text-muted">(50 Reviews)</span>
            </div>
            <p class="fs-4 fw-bold">@product.Price.ToString("0.00")€</p>
            <p>@product.Description</p>

            <p class="text-success fw-bold">✔ in stock</p>
            <p>Lagernd: @product.InStock+</p>

            <!-- Menge -->
            <div class="input-group mb-3" style="width: 150px;">
                <button class="btn btn-outline-secondary" @onclick="DecreaseQuantity">-</button>
                <input type="text" class="form-control text-center" value="@quantity" readonly />
                <button class="btn btn-outline-secondary" @onclick="IncreaseQuantity">+</button>
            </div>

            <!-- Add to Cart -->
            <button class="btn text-white w-100 mb-3" style="background-color:#C30017;" @onclick="AddToCart">Add to Cart</button>



            <!-- Lieferung -->
            <div class="border p-3">
                <p><strong>🚚 Free Delivery</strong></p>
                <p>Enter your postal code for Delivery Availability</p>
                <hr />
                <p><strong>🔁 Return Delivery</strong></p>
                <p>Free 30 days delivery returns.</p>
            </div>
        </div>
    </div>
</div>
}
