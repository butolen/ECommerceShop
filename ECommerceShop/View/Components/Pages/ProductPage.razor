@page "/product/{ProductId:int}"
@rendermode InteractiveServer
@layout MainLayout
@inject ShopContext Db
@inject NavigationManager Navigation
@inject IStoreService Ss
@inject LocalStorageService LocalStorage

@using ECommerceShop.Configurations
@using ECommerceShop.DLL
@using ECommerceShop.Entities
@using Microsoft.EntityFrameworkCore
@using View.Components.Layout
<style>
    .custom-nav-link {
        color: black;
        font-weight: 500;
        font-size: 1.2rem;
        padding: 7px 14px;
        border-radius: 6px;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .custom-nav-link:hover {
        background-color: #f0f0f0;
        color: #000;
        text-decoration: none;
    }

    .logout-btn {
        background-color: transparent;
        border: 2px solid #1f1f1f;
        color: #1f1f1f;
        padding: 6px 16px;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .logout-btn:hover {
        background-color: #1f1f1f;
        color: white;
    }
</style>

<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm py-3">
    <div class="container-fluid d-flex justify-content-between align-items-center">

        <!-- Logo -->
        <a class="navbar-brand fw-bold fs-3 text-dark" href="/" style="margin-right: 30px;">
            BulkBase
        </a>

        <!-- Navigation Buttons -->
        <div class="d-flex align-items-center gap-2">
            <a class="nav-link custom-nav-link" href="/">Start</a>
            <a class="nav-link custom-nav-link" href="/products">Produkte</a>
        </div>

        <!-- Sign Out + Cart -->
        <div class="d-flex align-items-center gap-3">
            <button class="btn logout-btn fw-semibold" @onclick="Logout">Ausloggen</button>
            <a class="nav-link position-relative" href="/cart">
                <img src="images/warenkorb.jpg" alt="Cart" style="height: 30px;" />
            </a>
        </div>
    </div>
</nav>


@*push*@
<!-- CONTENT -->
@code {
    private async Task Logout()
    {
        await LocalStorage.ClearUserData();
        Navigation.NavigateTo("/login", forceLoad: true);
    }
    
    private void AddToCart()
    {
        if (product != null)
        {
            Ss.AddToCart("h.muster", product.ProductId, quantity);
        }
    }

    
[Parameter]
public int ProductId { get; set; }

private Product? product;
private int quantity = 1;

protected override async Task OnInitializedAsync()
{
product = await Db.Products.FirstOrDefaultAsync(p => p.ProductId == ProductId);
}

private void IncreaseQuantity()
{
quantity++;
}

private void DecreaseQuantity()
{
if (quantity > 1)
quantity--;
}
}

@if (product == null)
{
<div class="container text-center mt-5">
    <h2>Product not found</h2>
</div>
}
else
{
<div class="container mt-5">
    <div class="row">
        <!-- Bildervorschau -->
        <div class="col-md-2 d-none d-md-block">
            <img src="@product.Image" class="img-thumbnail mb-3" />
            <img src="@product.Image" class="img-thumbnail mb-3" />
            <img src="@product.Image" class="img-thumbnail mb-3" />
        </div>

        <!-- Hauptbild -->
        <div class="col-md-5 text-center mb-4 mb-md-0">
            <img src="@product.Image" class="img-fluid" style="max-height: 350px;" />
        </div>

        <!-- Produktdetails -->
        <div class="col-md-5">
            <h2>@product.Name</h2>
            <div class="text-warning mb-2">
                ★★★★☆ <span class="text-muted">(50 Reviews)</span>
            </div>
            <p class="fs-4 fw-bold">@product.Price.ToString("0.00")€</p>
            <p>@product.Description</p>

            <p class="text-success fw-bold">✔ Lagernd</p>
            <p>Noch verfügbar: @product.InStock+</p>

            <!-- Menge -->
            <div class="input-group mb-3" style="width: 150px;">
                <button class="btn btn-outline-secondary" @onclick="DecreaseQuantity">-</button>
                <input type="text" class="form-control text-center" value="@quantity" readonly />
                <button class="btn btn-outline-secondary" @onclick="IncreaseQuantity">+</button>
            </div>

            <!-- Add to Cart -->
            <button class="btn text-white w-100 mb-3" style="background-color:#C30017;" @onclick="AddToCart">Zum Warenkorb hinzufügen</button>



            <!-- Lieferung -->
            <div class="border p-3">
                <p><strong>🚚 Kostenlose Lieferung</strong></p>
                <p>Postleizahl eingeben für mehr Lieferdetails</p>
                <hr />
                <p><strong>🔁 Rücksendung</strong></p>
                <p>Kostenlos für 30 Tage</p>
            </div>
        </div>
    </div>
</div>
}
